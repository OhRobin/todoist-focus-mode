---
layout: base.njk
title: "Todoist Focus Mode"
---
<h2>Get started</h2>
<form action="/.netlify/functions/auth-before">
    <input type="hidden" name="securePath" value="/secure/">
    <button type="submit" name="provider" value="todoist">Login with Todoist</button>
</form>
<hr>
<script>
    async function auth() {
        let url = "https://api.todoist.com/rest/v2/tasks";
        let response = await fetch(url, {
            headers: {
                Authorization: `Bearer ${apiKey}`
            }
        });

        if (response.ok) { // if HTTP-status is 200-299
            // get the response body (the method explained below)
            let taskList = await response.json();
            console.log(taskList)
            let firstTask = taskList[0].content
            const body = document.body;
            const div = document.createElement('div')
            div
                .classList
                .add("task-container")
            body.append(div)
            div.innerText = firstTask
            console.log("Done!")
        } else {
            alert("HTTP-Error: " + response.status);
        }
    }
</script>

{# ---- #}
<code>{{ td }}</code>
<form action="#" class="form" id="api-form">
    <div class="form-item">
        <label for="api-input">Enter Todoist API key:</label>
        <input type="text" required="true" minlength="40" maxlength="40" class="form-input" id="api-input" pattern="[a-zA-Z0-9]+">
    </div>
    <button type="submit" class="form-button">Submit</button>
</form>